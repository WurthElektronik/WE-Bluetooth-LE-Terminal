"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2728],{2728:(w,h,l)=>{l.r(h),l.d(h,{BluetoothLeWeb:()=>p});var n=l(5861),f=l(7423),c=l(4449);function v(){return(v=(0,n.Z)(function*(u,e,t){let i;return Promise.race([u,new Promise((r,a)=>{i=setTimeout(()=>a(t),e)})]).finally(()=>clearTimeout(i))})).apply(this,arguments)}class p extends f.Uw{constructor(){super(...arguments),this.deviceMap=new Map,this.discoveredDevices=new Map,this.scan=null,this.DEFAULT_CONNECTION_TIMEOUT=1e4,this.onAdvertisementReceivedCallback=this.onAdvertisementReceived.bind(this),this.onDisconnectedCallback=this.onDisconnected.bind(this),this.onCharacteristicValueChangedCallback=this.onCharacteristicValueChanged.bind(this)}initialize(){var e=this;return(0,n.Z)(function*(){if(typeof navigator>"u"||!navigator.bluetooth)throw e.unavailable("Web Bluetooth API not available in this browser.");if(!(yield navigator.bluetooth.getAvailability()))throw e.unavailable("No Bluetooth radio available.")})()}isEnabled(){return(0,n.Z)(function*(){return{value:!0}})()}enable(){var e=this;return(0,n.Z)(function*(){throw e.unavailable("enable is not available on web.")})()}disable(){var e=this;return(0,n.Z)(function*(){throw e.unavailable("disable is not available on web.")})()}startEnabledNotifications(){return(0,n.Z)(function*(){})()}stopEnabledNotifications(){return(0,n.Z)(function*(){})()}isLocationEnabled(){var e=this;return(0,n.Z)(function*(){throw e.unavailable("isLocationEnabled is not available on web.")})()}openLocationSettings(){var e=this;return(0,n.Z)(function*(){throw e.unavailable("openLocationSettings is not available on web.")})()}openBluetoothSettings(){var e=this;return(0,n.Z)(function*(){throw e.unavailable("openBluetoothSettings is not available on web.")})()}openAppSettings(){var e=this;return(0,n.Z)(function*(){throw e.unavailable("openAppSettings is not available on web.")})()}setDisplayStrings(){return(0,n.Z)(function*(){})()}requestDevice(e){var t=this;return(0,n.Z)(function*(){const i=t.getFilters(e),r=yield navigator.bluetooth.requestDevice({filters:i.length?i:void 0,optionalServices:e?.optionalServices,acceptAllDevices:0===i.length});return t.deviceMap.set(r.id,r),t.getBleDevice(r)})()}requestLEScan(e){var t=this;return(0,n.Z)(function*(){t.requestBleDeviceOptions=e;const i=t.getFilters(e);yield t.stopLEScan(),t.discoveredDevices=new Map,navigator.bluetooth.removeEventListener("advertisementreceived",t.onAdvertisementReceivedCallback),navigator.bluetooth.addEventListener("advertisementreceived",t.onAdvertisementReceivedCallback),t.scan=yield navigator.bluetooth.requestLEScan({filters:i.length?i:void 0,acceptAllAdvertisements:0===i.length,keepRepeatedDevices:e?.allowDuplicates})})()}onAdvertisementReceived(e){var t,i;const r=e.device.id;if(this.deviceMap.set(r,e.device),!this.discoveredDevices.has(r)||(null===(t=this.requestBleDeviceOptions)||void 0===t?void 0:t.allowDuplicates)){this.discoveredDevices.set(r,!0);const s=this.getBleDevice(e.device),o={device:s,localName:s.name,rssi:e.rssi,txPower:e.txPower,manufacturerData:(0,c.GA)(e.manufacturerData),serviceData:(0,c.GA)(e.serviceData),uuids:null===(i=e.uuids)||void 0===i?void 0:i.map(c.JA)};this.notifyListeners("onScanResult",o)}}stopLEScan(){var e=this;return(0,n.Z)(function*(){var t;!(null===(t=e.scan)||void 0===t)&&t.active&&e.scan.stop(),e.scan=null})()}getDevices(e){var t=this;return(0,n.Z)(function*(){return{devices:(yield navigator.bluetooth.getDevices()).filter(a=>e.deviceIds.includes(a.id)).map(a=>(t.deviceMap.set(a.id,a),t.getBleDevice(a)))}})()}getConnectedDevices(e){var t=this;return(0,n.Z)(function*(){return{devices:(yield navigator.bluetooth.getDevices()).filter(a=>{var s;return null===(s=a.gatt)||void 0===s?void 0:s.connected}).map(a=>(t.deviceMap.set(a.id,a),t.getBleDevice(a)))}})()}connect(e){var t=this;return(0,n.Z)(function*(){var i,r;const a=t.getDeviceFromMap(e.deviceId);a.removeEventListener("gattserverdisconnected",t.onDisconnectedCallback),a.addEventListener("gattserverdisconnected",t.onDisconnectedCallback);const s=Symbol();if(void 0===a.gatt)throw new Error("No gatt server available.");try{const o=null!==(i=e.timeout)&&void 0!==i?i:t.DEFAULT_CONNECTION_TIMEOUT;yield function g(u,e,t){return v.apply(this,arguments)}(a.gatt.connect(),o,s)}catch(o){throw yield null===(r=a.gatt)||void 0===r?void 0:r.disconnect(),o===s?new Error("Connection timeout"):o}})()}onDisconnected(e){this.notifyListeners(`disconnected|${e.target.id}`,null)}createBond(e){var t=this;return(0,n.Z)(function*(){throw t.unavailable("createBond is not available on web.")})()}isBonded(e){var t=this;return(0,n.Z)(function*(){throw t.unavailable("isBonded is not available on web.")})()}disconnect(e){var t=this;return(0,n.Z)(function*(){var i;null===(i=t.getDeviceFromMap(e.deviceId).gatt)||void 0===i||i.disconnect()})()}getServices(e){var t=this;return(0,n.Z)(function*(){var i,r;const a=null!==(r=yield null===(i=t.getDeviceFromMap(e.deviceId).gatt)||void 0===i?void 0:i.getPrimaryServices())&&void 0!==r?r:[],s=[];for(const o of a){const D=yield o.getCharacteristics(),b=[];for(const d of D)b.push({uuid:d.uuid,properties:t.getProperties(d),descriptors:yield t.getDescriptors(d)});s.push({uuid:o.uuid,characteristics:b})}return{services:s}})()}getDescriptors(e){return(0,n.Z)(function*(){try{return(yield e.getDescriptors()).map(i=>({uuid:i.uuid}))}catch{return[]}})()}getProperties(e){return{broadcast:e.properties.broadcast,read:e.properties.read,writeWithoutResponse:e.properties.writeWithoutResponse,write:e.properties.write,notify:e.properties.notify,indicate:e.properties.indicate,authenticatedSignedWrites:e.properties.authenticatedSignedWrites,reliableWrite:e.properties.reliableWrite,writableAuxiliaries:e.properties.writableAuxiliaries}}getCharacteristic(e){var t=this;return(0,n.Z)(function*(){var i;return(yield null===(i=t.getDeviceFromMap(e.deviceId).gatt)||void 0===i?void 0:i.getPrimaryService(e?.service))?.getCharacteristic(e?.characteristic)})()}getDescriptor(e){var t=this;return(0,n.Z)(function*(){return(yield t.getCharacteristic(e))?.getDescriptor(e?.descriptor)})()}discoverServices(e){var t=this;return(0,n.Z)(function*(){throw t.unavailable("discoverServices is not available on web.")})()}getMtu(e){var t=this;return(0,n.Z)(function*(){throw t.unavailable("getMtu is not available on web.")})()}requestConnectionPriority(e){var t=this;return(0,n.Z)(function*(){throw t.unavailable("requestConnectionPriority is not available on web.")})()}readRssi(e){var t=this;return(0,n.Z)(function*(){throw t.unavailable("readRssi is not available on web.")})()}read(e){var t=this;return(0,n.Z)(function*(){const i=yield t.getCharacteristic(e);return{value:yield i?.readValue()}})()}write(e){var t=this;return(0,n.Z)(function*(){const i=yield t.getCharacteristic(e);let r;r="string"==typeof e.value?(0,c._j)(e.value):e.value,yield i?.writeValueWithResponse(r)})()}writeWithoutResponse(e){var t=this;return(0,n.Z)(function*(){const i=yield t.getCharacteristic(e);let r;r="string"==typeof e.value?(0,c._j)(e.value):e.value,yield i?.writeValueWithoutResponse(r)})()}readDescriptor(e){var t=this;return(0,n.Z)(function*(){const i=yield t.getDescriptor(e);return{value:yield i?.readValue()}})()}writeDescriptor(e){var t=this;return(0,n.Z)(function*(){const i=yield t.getDescriptor(e);let r;r="string"==typeof e.value?(0,c._j)(e.value):e.value,yield i?.writeValue(r)})()}startNotifications(e){var t=this;return(0,n.Z)(function*(){const i=yield t.getCharacteristic(e);i?.removeEventListener("characteristicvaluechanged",t.onCharacteristicValueChangedCallback),i?.addEventListener("characteristicvaluechanged",t.onCharacteristicValueChangedCallback),yield i?.startNotifications()})()}onCharacteristicValueChanged(e){var t,i;const r=e.target,a=`notification|${null===(t=r.service)||void 0===t?void 0:t.device.id}|${null===(i=r.service)||void 0===i?void 0:i.uuid}|${r.uuid}`;this.notifyListeners(a,{value:r.value})}stopNotifications(e){var t=this;return(0,n.Z)(function*(){const i=yield t.getCharacteristic(e);yield i?.stopNotifications()})()}getFilters(e){var t;const i=[];for(const r of null!==(t=e?.services)&&void 0!==t?t:[])i.push({services:[r],name:e?.name,namePrefix:e?.namePrefix});return(e?.name||e?.namePrefix)&&0===i.length&&i.push({name:e.name,namePrefix:e.namePrefix}),i}getDeviceFromMap(e){const t=this.deviceMap.get(e);if(void 0===t)throw new Error('Device not found. Call "requestDevice", "requestLEScan" or "getDevices" first.');return t}getBleDevice(e){var t;return{deviceId:e.id,name:null!==(t=e.name)&&void 0!==t?t:void 0}}}}}]);